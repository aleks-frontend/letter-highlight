<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        .headingMaster {
            display: none;
        }

        em {
            color: red;
        }

        .underline {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="headingMaster">
        <span style="text-decoration: underline;">123</span> 4<span style="text-decoration: underline;">56</span> 789 12345 <span style="text-decoration: underline;">6789</span> <strong>123</strong>45<br>67<strong>89</strong>
    </div>
    <div class="js-sentence-output"></div>
<script>

function letterHighlight(source, target) {
    function Word(id) {
        this.id = id,
        this.hasHl = false,
        this.letters = []
    }

    function Letter(char = '', 
                    id = '', 
                    isLetter = 'false', 
                    isEmptySpace = 'false',
                    isLineBreak = 'false',
                    isUnderlineStart = 'false', 
                    isUnderlineEnd = 'false', 
                    isBoldStart = 'false', 
                    isBoldEnd = 'false', 
                    isHighlighted = 'false',
                    wordIndex = null) {
        this.char = char,
        this.id = id,
        this.isLetter = isLetter,
        this.isEmptySpace = isEmptySpace,
        this.isLineBreak = isLineBreak,
        this.isUnderlineStart = isUnderlineStart,
        this.isUnderlineEnd = isUnderlineEnd,
        this.isBoldStart = isBoldStart,
        this.isBoldEnd = isBoldEnd,
        this.isHighlighted = isHighlighted,
        this.wordIndex = wordIndex
    }

    let characters = [];
    let checkingSixth = false;
    let lastHl;
    let letters = [];
    let words = [];

    words.push(new Word(0));

    let sentenceHTML = document.querySelector(source).innerHTML;
    sentenceHTML = sentenceHTML.replace(/<span style="text-decoration: underline;">/gi, '{');
    sentenceHTML = sentenceHTML.replace(/<span style="text-decoration: underline;" data-mce-style="text-decoration: underline;">/gi, '{');
    sentenceHTML = sentenceHTML.replace(/<\/span>/gi, '}');
    sentenceHTML = sentenceHTML.replace(/&nbsp;/gi, ' ');
    sentenceHTML = sentenceHTML.replace(/<br>/gi, '~');
    sentenceHTML = sentenceHTML.replace(/<strong>/gi, '[');
    sentenceHTML = sentenceHTML.replace(/<\/strong>/gi, ']');

    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = sentenceHTML; 
    const sentence = Array.from(tempDiv.innerText);

    sentence.forEach((letter, index) => {
        const isLetter = letter !== ' ' && letter !== '~' && letter !== '{' && letter !== '}' && letter !== '[' && letter !== ']';
        const isEmptySpace = letter == ' ';
        const isLineBreak = letter == '~';
        const isUnderlineStart = letter == '{';
        const isUnderlineEnd = letter == '}';
        const isBoldStart = letter == '[';
        const isBoldEnd = letter == ']';
        const id = index;

        if ( letters.length !== 0 && (letters[index - 1].isEmptySpace || letters[index - 1].isLineBreak ) ) {
            words.push(new Word(words.length));
        }

        letters.push(new Letter(letter, id, isLetter, isEmptySpace, isLineBreak, isUnderlineStart, isUnderlineEnd, isBoldStart, isBoldEnd, false, words.length - 1));
    });

    characters = letters.filter(letter => {
        if ( letter.isLetter ) {
            words[letter.wordIndex].letters.push(letter.char);
            return true;
        }
    });

    const highlighted = characters.filter((char, index) => {
        if ( !checkingSixth && // Checking if we are looking for sixth element
            ( index == 2 || ( index == lastHl + 3 ) ) ) {
            checkingSixth = true; // After this iteration we are looking 6th element
            lastHl  = index; // Setting the current element as the last highlighted element
            return true;
        }

        if ( checkingSixth && (index == lastHl + 6) ) { // Checking if we are on 6th element from the last highlighted one
            checkingSixth = false;
            lastHl = index;
            return true;
        }
    });

    letters.forEach(letter => {
        highlighted.forEach(hl => {
            if ( letter.id == hl.id ) {
                if ( !words[letter.wordIndex].hasHl && words[letter.wordIndex].letters.length > 2 ) {
                    letter.isHighlighted = true;
                    words[letter.wordIndex].hasHl = true;
                }
            }
        })
    });

    const formated = letters.map(letter => {
        if ( letter.isUnderlineStart ) return '<span style="text-decoration: underline;">';
        if ( letter.isUnderlineEnd ) return '</span>';

        if ( letter.isBoldStart ) return '<strong>';
        if ( letter.isBoldEnd ) return '</strong>';

        if ( letter.isLineBreak ) return '<br>';

        if ( letter.isHighlighted ) {
            return `<em>${letter.char}</em>`;
        } else {
            return letter.char;
        }
    }).join('');

    document.querySelector(target).innerHTML = formated;
}

letterHighlight('.headingMaster', '.js-sentence-output');
</script>
</body>
</html>