<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        strong {
            color: red;
        }

        .headingMaster {
            display: none;
        }

        em {
            color: red;
        }

        .underline {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="headingMaster"><span style="text-decoration: underline;">123</span> 4<span style="text-decoration: underline;">56</span> 12 345 <span style="text-decoration: underline;">612345<br>6123456</span></div>
    <div class="js-sentence-output"></div>
<script>

function letterHighlight() {
    function Word(id) {
        this.id = id,
        this.hasHl = false,
        this.letters = []
    }

    function Letter(char = '', 
                    id = '', 
                    isLetter = 'false', 
                    isEmptySpace = 'false',
                    isLineBreak = 'false',
                    isUnderlineStart = 'false', 
                    isUnderlineEnd = 'false', 
                    isHighlighted = 'false',
                    wordIndex = null) {
        this.char = char,
        this.id = id,
        this.isLetter = isLetter,
        this.isEmptySpace = isEmptySpace,
        this.isLineBreak = isLineBreak,
        this.isUnderlineStart = isUnderlineStart,
        this.isUnderlineEnd = isUnderlineEnd,
        this.isHighlighted = isHighlighted,
        this.wordIndex = wordIndex
    }

    let words = [];

    let letters = [];
    let characters = [];

    words.push(new Word(0));

    let sentenceHTML = document.querySelector('.headingMaster').innerHTML;
    sentenceHTML = sentenceHTML.replace(/<span style="text-decoration: underline;">/gi, '{');
    sentenceHTML = sentenceHTML.replace(/<span style="text-decoration: underline;" data-mce-style="text-decoration: underline;">/gi, '{');
    sentenceHTML = sentenceHTML.replace(/<\/span>/gi, '}');
    sentenceHTML = sentenceHTML.replace(/&nbsp;/gi, ' ');
    sentenceHTML = sentenceHTML.replace(/<br>/gi, '~');

    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = sentenceHTML; 
    const sentence = Array.from(tempDiv.innerText);

    sentence.forEach((letter, index) => {
        const isLetter = letter !== ' ' && letter !== '~' && letter !== '{' && letter !== '}';
        const isEmptySpace = letter == ' ';
        const isLineBreak = letter == '~';
        const isUnderlineStart = letter == '{';
        const isUnderlineEnd = letter == '}';
        const id = index;

        if ( letters.length !== 0 && (letters[index - 1].isEmptySpace || letters[index - 1].isLineBreak ) ) {
            words.push(new Word(words.length));
        }

        letters.push(new Letter(letter, id, isLetter, isEmptySpace, isLineBreak, isUnderlineStart, isUnderlineEnd, false, words.length - 1));
    });

    characters = letters.filter(letter => {
        if ( letter.isLetter ) {
            words[letter.wordIndex].letters.push(letter.char);
            return true;
        }
    });

    const highlighted = characters.filter((char, index) => {
        if ( (index + 1) % 6 == 0 ) return true;
    });

    letters.forEach(letter => {
        highlighted.forEach(hl => {
            if ( letter.id == hl.id ) {
                if ( !words[letter.wordIndex].hasHl && words[letter.wordIndex].letters.length > 2 ) {
                    letter.isHighlighted = true;
                    words[letter.wordIndex].hasHl = true;
                }
            }
        })
    });

    const formated = letters.map(letter => {
        if ( letter.isUnderlineStart ) return '<span style="text-decoration: underline;">';

        if ( letter.isUnderlineEnd ) return '</span>';

        if ( letter.isLineBreak ) return '<br>';

        if ( letter.isHighlighted ) {
            return `<em>${letter.char}</em>`;
        } else {
            return letter.char;
        }
    }).join('');

    document.querySelector('.js-sentence-output').innerHTML = formated;
}

letterHighlight('.js-sentence-output');
</script>
</body>
</html>